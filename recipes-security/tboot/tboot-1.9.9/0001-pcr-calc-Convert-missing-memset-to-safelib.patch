From 5ec9e9aa9e3ae8413e156e28a0d2b9c4fd3eaa48 Mon Sep 17 00:00:00 2001
From: Eric Chanudet <chanudete@ainfosec.com>
Date: Thu, 7 Mar 2019 16:12:21 -0500
Subject: [PATCH 1/9] pcr-calc: Convert missing memset to safelib.

Two instances of memset() were left out.

Signed-off-by: Eric Chanudet <chanudete@ainfosec.com>
---
 pcr-calc/util.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/pcr-calc/util.c b/pcr-calc/util.c
index 5d79ffb..a9b643f 100644
--- a/pcr-calc/util.c
+++ b/pcr-calc/util.c
@@ -42,6 +42,7 @@
 #include <fcntl.h>
 #include <unistd.h>
 #include <limits.h>
+#include <safe_lib.h>
 
 #include "../include/hash.h"
 #include "uuid.h"
@@ -56,7 +57,7 @@ bool read_hash(const char *hexstr, tb_hash_t *hash)
 	unsigned char *buf = (unsigned char *)hash;
 
 	if (len == 1 && hexstr[0] == '0') {
-		memset(hash, 0, sizeof(tb_hash_t));
+		memset_s(hash, sizeof(tb_hash_t), 0);
 		return true;
 	}
 
@@ -152,6 +153,8 @@ int read_pcr_event(const char *s, struct pcr_event *evt)
 	if (len >= PCREVT_BUF_LEN)
 		return -1;
 
+	memset_s(&digest, sizeof (tb_hash_t), 0);
+
 	type = strtoul(s, &end, 0);
 	if (type == ULONG_MAX)
 		return -1;
-- 
2.21.0

