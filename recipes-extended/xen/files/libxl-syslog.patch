################################################################################
SHORT DESCRIPTION:
################################################################################
Log to syslog instead of logfiles

################################################################################
LONG DESCRIPTION:
################################################################################
LibXL only has one way to log messages, which uses log files.
In OpenXT, we want all logs to go through syslog.
This patch does that.

################################################################################
CHANGELOG
################################################################################
Authors:
Jed Lejosne <lejosnej@ainfosec.com>

################################################################################
REMOVAL
################################################################################
If syslog support gets added upstream, we should remove this patch

################################################################################
UPSTREAM PLAN
################################################################################
As is it, this patch is not upstream-able.
Givent the opportunity, we could make it right (adding an option to choose files
or syslog) and then upstream it.

################################################################################
INTERNAL DEPENDENCIES
################################################################################

################################################################################
PATCHES
################################################################################
Index: xen-4.6.1/tools/libxl/xl_cmdimpl.c
===================================================================
--- xen-4.6.1.orig/tools/libxl/xl_cmdimpl.c
+++ xen-4.6.1/tools/libxl/xl_cmdimpl.c
@@ -475,7 +475,6 @@ out:
 
 static int do_daemonize(char *name, const char *pidfile)
 {
-    char *fullname;
     pid_t child1;
     int nullfd, ret = 0;
 
@@ -489,19 +488,10 @@ static int do_daemonize(char *name, cons
 
     postfork();
 
-    ret = libxl_create_logfile(ctx, name, &fullname);
-    if (ret) {
-        LOG("failed to open logfile %s: %s",fullname,strerror(errno));
-        exit(-1);
-    }
-
-    CHK_SYSCALL(logfile = open(fullname, O_WRONLY|O_CREAT|O_APPEND, 0644));
-    free(fullname);
+    /* OpenXT: we don't want separate logfiles */
 
     CHK_SYSCALL(nullfd = open("/dev/null", O_RDONLY));
     dup2(nullfd, 0);
-    dup2(logfile, 1);
-    dup2(logfile, 2);
 
     CHK_SYSCALL(daemon(0, 1));
 
